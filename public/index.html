<!DOCTYPE html>
<html>
	<head>
		<script src='https://code.jquery.com/jquery-1.9.1.min.js'></script>
		<style>

			html, body, div, span, applet, object, iframe,
			h1, h2, h3, h4, h5, h6, p, blockquote, pre,
			a, abbr, acronym, address, big, cite, code,
			del, dfn, em, img, ins, kbd, q, s, samp,
			small, strike, strong, sub, sup, tt, var,
			b, u, i, center,
			dl, dt, dd, ol, ul, li,
			fieldset, form, label, legend,
			table, caption, tbody, tfoot, thead, tr, th, td,
			article, aside, canvas, details, embed, 
			figure, figcaption, footer, header, hgroup, 
			menu, nav, output, ruby, section, summary,
			time, mark, audio, video {
				margin: 0;
				padding: 0;
				border: 0;
				font-size: 100%;
				font: inherit;
				vertical-align: baseline;
			}

			body {
				font-family: "Lucida Console", Monaco, monospace;
				background-color: #ebebe0;
			}

			button {
				font-family: "Lucida Console", Monaco, monospace;
			}

			form {
				text-align: center;
			}

			td {
				font-size: 2.55em;
				color: white;
				vertical-align: middle;

				background-color: white;
				height: 50px;
				width: 50px;
				border: 3px hidden #f4f4f0;
				border-radius: 9px;
			}

			#container {
				margin-top: 7.5%;
			}

			#title {
				text-align: center;
				font-size: 6.4em;
			}

			#options {
				font-size: 1.2em;
				letter-spacing: -1px;

				background-color: white;
				border: 1px solid black;
				border-radius: 3px;
				height: 42px;
				width: 41%;
				padding-top: 14px;
				margin-top: 1.3%;
				margin-left: auto;
				margin-right: auto;
			}

			#newgame {
				box-shadow: 4px 4px 3px #888888;
			}

			#newgame, #guess {
				text-align: center;
				font-size: 2.3em;
				letter-spacing: .08em;

				cursor: default;
				background-color: white;
				border: 1px solid black;
				border-radius: 3px;
				height: 49px;
				width: 34%;
				padding-top: 4px;
				margin-top: 1.6%;
				margin-left: auto;
				margin-right: auto;
			}

			#stats {
				display: none;
				margin-left: auto;
				margin-right: auto;
				font-size: 1.1em;
				padding-top: 5px;
				height: 49px;
			}

			#stats, #guessForm input {
				font-family: "Lucida Console", Monaco, monospace;
				text-align: center;

				background-color: white;
				margin-top: 1.85%;
				width: 28.5%;
				border: 1px solid black;
				border-radius: 3px;
			}

			#guessForm input {
				height: 54px;
				font-size: 2.65em;
				letter-spacing: 6px;
				color: #cc0000;
			}

			#guess {
				width: 24%;
			}

			#feedback {
				margin-top: 1.1%;
				margin-left: auto;
				margin-right: auto;
				text-align: center;
				border-spacing: 8px;
			}
			
			#history {
				position: absolute;
				top: 0;
				width: 23.5%;
				text-align: center;
				border-spacing: 5px;
			}

			#hideUntried {
				display: none;
				position: absolute;
				top: 3px;
				right: 3px;
				width: 22.4%;
				height: 25px;
				font-size: 1.2em;
				text-align: center;
				background-color: white;
				border: 1px solid black;
				border-radius: 3px;
				box-shadow: 3px 3px 2px #888888;
			}

			#untried {	
				color: black;
				position: absolute;
				top: 20px;
				right: 0;
				width: 23%;
				text-align: center;
				border-spacing: 5px;
			}

			#category, #letters {
				font-family: "Lucida Console", Monaco, monospace;
				background-color: white;
		    height: 32px;
		    font-size: 0.75em;	
		    width: 85px;
			}

			#letters {
				width: 55px;
  	    text-align: center;
			}

			.full {
				background-color: #248f24;
			}

			.half {
				background-color: #e6b700;
			}

			.none {
				background-color: #cc0000;
			}

			.turns, .untried {
				color: black;
				font-size: 2.1em;
			}

			.lastGuess {
				color: black;
				font-size: 1.42em;
				letter-spacing: -1px;
			}

		</style>
	<head>
	<body>

		<table id="history"></table>
		<table id="untried"></table>
		<button id="hideUntried">hide untried letters</button>

		<div id="container">
			<div id="title">wor<span style="color:#cc0000">db</span>reaker</div>

			<form id="options">
				<label>category:</label>
				<select id="category">
			    <option value="all">all</option>
			    <option value="animals">animals</option>
			    <option value="clothes">clothes</option>
			    <option value="flowers">flowers</option>
			    <option value="fruits">fruits</option>
			    <option value="vegetables">veggies</option>
			  </select>
			  <label>letters:</label>
				<select id="letters">
			    <option value="any">any</option>	
			    <option value="3">3</option>
			    <option value="4">4</option>
			    <option value="5">5</option>
			    <option value="6">6</option>
			    <option value="7">7</option>
			    <option value="8">8</option>
			  </select>
			  <input type="radio" name="mode" id="normal" checked> normal
			  <input type="radio" name="mode" id="hard"> hard
			</form>

			<div id="newgame" onclick="makeGame()">give me a word</div>

			<form id="guessForm">
				<input id="guessInput" type="text" maxlength="8" value="">
			</form> 

			<div id="stats"></div>

			<div id="guess" onclick="guess()">guess</div>

			<table id="feedback"></table>
		</div>

		<script>

			var mode;
			var untriedLetters = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];

			//calling gameID(567) sets id to 567 and returns 567. subsequent calling gameID() returns 567.
			var gameID = function(set) { 
				var id = set;
				return function(set) {
					if (set) return id = set; 
					else return id;	
				}; 
			}();
			//calling turns() increments it by one and returns it. calling turns(true) resets it to 0 and returns 0.
			var turns = function(reset) { 
				var turns = 0;
				return function(reset) {
					if (reset) return turns = 0;
					else return turns++;
				}
			}();

			$(document).ready(function() { //prevents default behavior of hitting enter from a form field, runs guess() instead
				$(document).on('keypress', 'form input[type="text"]', function(e) {
				  if(e.keyCode == 13) {
				    e.preventDefault();
				    guess();
				    return false;	
				  }
				});
			});

			$('#hideUntried').click(function() {
				if ($('#hideUntried').html() == 'hide untried letters') {
					$('#untried').css('display', 'none');
					$('#hideUntried').html('show untried letters');
				} else {
					$('#untried').css('display', 'table');
					$('#hideUntried').html('hide untried letters');
				}
			});

			function makeGame() {
				if ($('#newgame').html() == 'give me a word') {
					if ($("input[id='hard']:checked").val()) mode = 'hard';
					if ($("input[id='normal']:checked").val()) mode = 'normal';
					var options = {
						category: ($("select[id='category']").val()),
						letters: ($("select[id='letters']").val()),
						mode: mode
					};
		      $.ajax({url: "new", method: "POST", data: options, success: function(result) {
		      	if(result.err) {
		      		alert('No word found.');
				    } else {
			      	gameID(result.id);
			      	newGameStarted(result.length);
				    }
			  	}});
		    }
			}

			function newGameStarted(letters) { 
				resetUntried();
				turns(true);
				$('#guessForm').css('display', 'block');
				$('#stats').css('display', 'none');
				$('#newgame').css('box-shadow', 'none');
				$('#guess').css('box-shadow', '4px 4px 3px #888888');
				$('#hideUntried').css('display', 'none');
				$('input[id="guessInput"]').val('');
				$('#guessInput').select();
				$('#untried').html('');
				$('#title').html('wor<span style="color:#cc0000">db</span>reaker');
		  	$('#guess').html('guess');
				$('#feedback').html('');
				$('#history').html('');
	     	$('#newgame').html(letters + ' letter word');
		   	$('input').attr("maxlength", letters);
			}

			function guess() {
				$('#hideUntried').css('display', 'block');
				var input = $('input[id="guessInput"]').val();
				for (i=0; i<input.length; i++) {
					removeLetter(input[i]);
				}
				$('input[id="guessInput"]').val('');
				$.ajax({url: gameID() +'/' + input, success: function(result) {
					if (result.gameOver) winner(result.arr, result.stats);
					else if (mode == 'hard') displayHard(result.arr);
					else displayFeedback(result.arr);
					displayUntried();
		  	}});
			}
		
			function displayFeedback(resArray) {
				displayHistory();
				$('#feedback').html('');
				for (i=0; i<resArray.length; i++) {
					if (resArray[i][1] == '2') $('#feedback').append('<td class="full">' + resArray[i][0] + '</td>');
					if (resArray[i][1] == '1') $('#feedback').append('<td class="half">' + resArray[i][0] + '</td>');
					if (resArray[i][1] == '0') $('#feedback').append('<td class="none">' + resArray[i][0] + '</td>');
				}
			}
			
			function displayHard(resArray) {
				displayHistory();
				var hardArray = [];
				var lastGuess = '';
				for (i=0; i<resArray.length; i++) {
					lastGuess += resArray[i][0];
					hardArray.push(resArray[i][1]);
				}
				hardArray.sort(function(a, b){return b-a});
				$('#feedback').html('');
				$('#feedback').append('<td class="lastGuess">' + lastGuess + '</td>')
				for (i=0; i<hardArray.length; i++) {
					if (hardArray[i] == '2') $('#feedback').append('<td class="full"> </td>');
					if (hardArray[i] == '1') $('#feedback').append('<td class="half"> </td>');
					if (hardArray[i] == '0') $('#feedback').append('<td class="none"> </td>');
				}
			}

			function winner(resArray, stats) {
				displayHistory();
				$('#feedback').html('');
				for (i=0; i<resArray.length; i++) {
					$('#feedback').append('<td class="full">' + resArray[i][0] + '</td>');
				}
				$('#stats').html('avg time: ' + stats.avgTime + ', your time: ' + stats.yourTime);
				$('#stats').append('<br>avg guesses: ' + stats.avgGuesses + ', your guesses: ' + turns());
				$('#newgame').html('give me a word');
				$('#newgame').css('box-shadow', '3px 3px 2px #888888');
				$('#guess').css('box-shadow', 'none');
				$('#guessForm').css('display', 'none');
				$('#stats').css('display', 'block');
				$('#guess').html('you won!');
				$('#title').html('wor<span style="color:#248f24">db</span>reaker');
			}

			function displayHistory() {
				var turnCount = '<td class="turns">' + turns() + '</td>';
				var feedback = $('#feedback').html();
				var history = turnCount + feedback;
				if (feedback !== '') $('#history').prepend('<tr>' + history + '</tr>');
			}

			function displayUntried() {
				$('#untried').html('<tr>');
				untriedLetters.forEach(function (val, index) {
					if ((index % 4) == 0) $('#untried').append('</tr> <tr>');
					$('#untried').append('<td class="untried">' + val + '</td>');
				});
				$('#untried').append('</tr>');
			}

			function removeLetter(letter) {
				var index = $.inArray(letter, untriedLetters);
				if (index !== -1) untriedLetters.splice(index, 1);
			}

			function resetUntried() {
				untriedLetters = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];
			}

		</script>
	</body>
</html>

